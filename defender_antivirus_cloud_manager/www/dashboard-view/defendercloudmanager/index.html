<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />

    <!-- ✅ Load CSS file for DataTables  -->
    <link rel="stylesheet" href="/assets/defender_antivirus_cloud_manager/www/css/jquery.dataTables.min.css" />


    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js" integrity="sha512-ElRFoEQdI5Ht6kZvyzXhYG9NqjtkmlkfYk0wr6wHxU9JEHakS7UJZNeml5ALk+8IKlU6jDgMabC3vkumRokgJA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    
  
    <!-- ✅ load jQuery ✅ -->
    <script src="/assets/defender_antivirus_cloud_manager/www/js/jquery-3.6.0.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>


    <!-- ✅ load DataTables ✅ -->
    <script src="/assets/defender_antivirus_cloud_manager/www/js/jquery.dataTables.min.js"></script>
    <script src="https://unpkg.com/read-excel-file@4.x/bundle/read-excel-file.min.js"></script>

   


        <!--  ✅ FullStory  ✅ -->
        <link rel="shortcut icon"href="/assets/erpnext/images/erpnext-favicon.svg" type="image/x-icon">

        <!--  ✅ Frappe Resources  ✅ -->
        <link rel="icon" href="/assets/erpnext/images/erpnext-favicon.svg" type="image/x-icon">
        <link type="text/css" rel="stylesheet" href="/assets/css/erpnext.css?ver=1650788325.0">
        <link type="text/css" rel="stylesheet" href="/assets/css/desk.min.css">

        <link rel="stylesheet" href="/assets/defender_antivirus_cloud_manager/www/bootstrap-4.2.1/css/bootstrap.min.css">
        <script>
            window.frappe = {};
            frappe.ready_events = [];
            frappe.ready = function(fn) {
                frappe.ready_events.push(fn);
            }
            window.dev_server = 0;
            window.socketio_port = 9000;
            window.show_language_picker = 0;
        </script>
    
    
        <!--Frappe Resources-->

  
</head>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

<style>
    .Row {
        display: table;
        width: 100%;
        table-layout: fixed;
        border-spacing: 8px;
    }

    .card {
        display: table-cell;
        box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2);
        transition: 0.3s;
        width: 210%;
        height: 140px;

    }

    .card1 {
        display: table-cell;
        box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2);
        transition: 0.3s;
        width: 210%;
        height: 200px;

    }

    .card:hover {
        box-shadow: 0 8px 16px 0 rgba(0, 0, 0, 0.2);
    }

    .container {
        padding: 2px 16px;
    }

    #bt {
        border-radius: 7px;
        /* background: #8fe2ff; */
        border-color: #5fe5f566;
        float: right;
        cursor: pointer;
    }

    #updatebt {
        border-radius: 7px;
        /* background: #8fe2ff; */
        border-color: #5fe5f566;
        float: right;
        cursor: pointer;
    }
    #deletebt {
        border-radius: 7px;
        /* background: #8fe2ff; */
        border-color: #5fe5f566;
        float: right;
        cursor: pointer;
    }


    body {
        font-family: Arial;
    }


    .tab {
        overflow: hidden;
    }

    .tab button {
        background-color: inherit;
        float: left;
        border: none;
        outline: none;
        cursor: pointer;
        padding: 14px 16px;
        transition: 0.3s;
        font-size: 17px;
    }

    /* Change background color of buttons on hover */
    .tab button:hover {}

    /* Create an active/current tablink class */
    .tab button.active {
        text-decoration: underline;
        color: #009bfff7;
    }

    /* Style the tab content */
    .tabcontent {
        display: none;
        padding: 6px 12px;
        border-top: none;
    }
    .host_details {
      background-color: #cacaca40;
      max-width: 1009px !important;

      margin-top: 1%;
      padding-bottom: 1%;
    }

    .inner_host_details {

      max-width: 1000px !important;

      margin: 1%;
      background-color: none;


    }

    .row_box_one {
      display: flex;
    flex-wrap: wrap;
    justify-content: space-between;
    }

    .div1 {

      background-color: #ffffffeb;
      width: 32.3%;
      height: 80px;
      border-radius: 6px;
      margin-top: 1.3%; 
  }

   
  .div2 {

    background-color: #ffffffeb;
    width: 66.3%;
    height: 80px;
    border-radius: 6px;
    margin-top: 1.3%;
}

.div_p {
 
    padding-top: 9%;
    padding-left: 6%;
    margin-bottom: 4px !important;
  
}

.child-divp {
  font-size: 10px;
  margin-left: 6%;
}


    
</style>

<body frappe-session-status="logged-in" data-path="index" class="bp-nouveau archive post-type-archive post-type-archive-sfwd-courses tribe-js buddyboss-theme sticky-header bb-tribe-events-views-v2 bp-search elementor-default elementor-kit-20002 tribe-theme-buddyboss-theme learndash-cpt learndash-cpt-sfwd-courses learndash-template-ld30 learndash-embed-responsive learndash-theme js bb-page-loaded">
  {% with sys = frappe.session.user %}
  {% set us = frappe.db.sql(""" select first_name, user_type from `tabUser` where first_name=%s or email=%s""", (sys,sys)) %}  
  
  <div class="tab">
        <button class="tablinks" onclick="openCity(event, 'Dashboards')" id="defaultOpen">Dashboards</button>
        <button class="tablinks" onclick="openCity(event, 'Clients')">Clients</button>
        <button class="tablinks" onclick="openCity(event, 'Logs')">Logs</button>
        <button class="tablinks" onclick="show()" style="float:right;color: #085281;" {% if us[0][1] == 'System User' %} {% else %} disabled {% endif %}><i class="fa fa-file-excel-o"
                aria-hidden="true" style="    color: #0a88d885;
            margin-right: 2px;"></i>Export to excel file</button>

    </div>

    {% if frappe.session.user == 'Guest' %}
    <button class="btn btn-primary" onclick="goto()" style="display: flex;
    margin-left: 1%;
    width: 200px;
    justify-content: center;"> Login</button>
    <div class="box" style="background: #83bff226;height: auto;  display:none;">
      {% else %}
    <div class="box" style="background: #83bff226;height: auto;">

      
      
      {% endif %} 
    
      <div id="Dashboards" class="tabcontent" style="background:aliceblue !important">
        
        <!-- <h3>Dashboards</h3> -->
        {% set total = frappe.db.sql(""" select count(name) as name from `tabClients Details` """) %}
        <h3>Total <strong style="color: rgb(2, 232, 98); ">{{total[0][0]}}</strong>  Hosts</h3>
        <div class="container page-body">
          <div class="page-toolbar hide">
            <div class="container"> </div>
          </div>
          <div class="page-wrapper">
            <div class="page-content">
              <div class="dashboard" style="overflow: visible">
                <div class="dashboard-graph">
                  <div class="widget-group ">
                    <div class="widget-group-head">
    
                      <div class="widget-group-control"></div>
                    </div>
                    <div class="widget-group-body grid-col-3">
                      <div class="widget         widget-shadow    number-widget-box" data-widget-name="New Loans">
                        <div class="widget-head">
                          <div class="widget-label">
                            <div class="widget-title">
                              <div class="number-label" style="font-size: 16px;font-weight: bold;">Threat Protection issue</div>
                            </div>
                            <div class="widget-subtitle"></div>
                          </div>
                          <div class="widget-control">
                            <div class="card-actions dropdown pull-right">
                              <a data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                ...
                              </a>
                              <ul class="dropdown-menu" style="max-height: 300px; overflow-y: auto;">
                                <li class="dropdown-item">
                                  <a data-action="action-refresh">Refresh</a>
                                </li>
                                <li class="dropdown-item">
                                  <a data-action="action-edit">Edit</a>
                                </li>
                              </ul>
                            </div>
                          </div>
                        </div>
                        <div class="widget-body">
                          <div class="widget-content">
                          
                            <div class="number" style="color:red">{{defender_status[0].name}}</div>
                           
                          </div>
                        </div>
                        <div class="widget-footer">
                        </div>
                      </div>
                      <div class="widget         widget-shadow    number-widget-box" data-widget-name="Active Loans">
                        <div class="widget-head">
                          <div class="widget-label">
                            <div class="widget-title">
                              <div class="number-label" style="font-size: 16px;font-weight: bold;">Firewall issue</div>
                            </div>
                            <div class="widget-subtitle"></div>
                          </div>
                          <div class="widget-control">
                            <div class="card-actions dropdown pull-right">
                              <a data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                ...
                              </a>
                              <ul class="dropdown-menu" style="max-height: 300px; overflow-y: auto;">
                                <li class="dropdown-item">
                                  <a data-action="action-refresh">Refresh</a>
                                </li>
                                <li class="dropdown-item">
                                  <a data-action="action-edit">Edit</a>
                                </li>
                              </ul>
                            </div>
                          </div>
                        </div>
                        <div class="widget-body">
                          <div class="widget-content">
                            
                            <div class="number" style="color:#dcbf02a3;">{{firewall_status[0].name}}</div>
                           
                            
                          </div>
                        </div>
                        <div class="widget-footer">
                        </div>
                      </div>
                      <div class="widget         widget-shadow    number-widget-box" data-widget-name="Closed Loans">
                        <div class="widget-head">
                          <div class="widget-label">
                            <div class="widget-title">
                              <div class="number-label" style="font-size: 16px;font-weight: bold;">Signature out dated</div>
                            </div>
                            <div class="widget-subtitle"></div>
                          </div>
                          <div class="widget-control">
                            <div class="card-actions dropdown pull-right">
                              <a data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                ...
                              </a>
                              <ul class="dropdown-menu" style="max-height: 300px; overflow-y: auto;">
                                <li class="dropdown-item">
                                  <a data-action="action-refresh">Refresh</a>
                                </li>
                                <li class="dropdown-item">
                                  <a data-action="action-edit">Edit</a>
                                </li>
                              </ul>
                            </div>
                          </div>
                        </div>
                        <div class="widget-body">
                          <div class="widget-content">
                           
                            <div class="number" style="color:blue">{{signature_update[0].name}}</div>
                          
                            
                          </div>
                        </div>
                        <div class="widget-footer">
                        </div>
                      </div>
                      <div class="widget         widget-shadow    number-widget-box" data-widget-name="Total Disbursed">
                        <div class="widget-head">
                          <div class="widget-label">
                            <div class="widget-title">
                              <div class="number-label" style="font-size: 16px;font-weight: bold;">Fully protected</div>
                            </div>
                            <div class="widget-subtitle"></div>
                          </div>
                          <div class="widget-control">
                            <div class="card-actions dropdown pull-right">
                              <a data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                ...
                              </a>
                              <ul class="dropdown-menu" style="max-height: 300px; overflow-y: auto;">
                                <li class="dropdown-item">
                                  <a data-action="action-refresh">Refresh</a>
                                </li>
                                <li class="dropdown-item">
                                  <a data-action="action-edit">Edit</a>
                                </li>
                              </ul>
                            </div>
                          </div>
                        </div>
                        <div class="widget-body">
                          <div class="widget-content">
                           
                            <div class="number" style="color:blue">{{fully_protected_status[0].name}}</div>
                           
                          </div>
                        </div>
                        <div class="widget-footer">
                        </div>
                      </div>
                  
                    </div>


                    <!-- List of Threats -->
                     <div class="widget-group-body grid-col-2" style="margin-top: 2%;">
                      <div class="widget   widget-shadow    number-widget-box" data-widget-name="Closed Loans" style="height: auto !important;">
                        <div class="widget-head">
                          <div class="widget-label">
                            <div class="widget-title">
                              <div class="number-label" style="font-size: 20px;font-weight: bold;font-family: inherit;">Top 10 threats</div>
                            </div>
                            <div class="widget-subtitle"></div>
                          </div>
                          <div class="widget-control">
                            <div class="card-actions dropdown pull-right">
                              <a data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                ...
                              </a>
                              <ul class="dropdown-menu" style="max-height: 300px; overflow-y: auto;">
                                <li class="dropdown-item">
                                  <a data-action="action-refresh">Refresh</a>
                                </li>
                                <li class="dropdown-item">
                                  <a data-action="action-edit">Edit</a>
                                </li>
                              </ul>
                            </div>
                          </div>
                        </div>
                        <div class="widget-body">
                          {% for t in top_threats %}
                          <div class="widget-content" style="padding-top: 2px !important;">
                            <div class="number" style="font-size:12px !important; color:rgb(42, 42, 205)">{{t.threatname}} - <strong style="color:#e1a90d; font-weight:bold; font-size:16px;">{{t.name}}</strong></div>
                          </div>
                          {% endfor %}
                      
                        </div>
                        <div class="widget-footer">
                        </div>
                      </div>
                      <div class="widget         widget-shadow    number-widget-box" data-widget-name="Total Disbursed" style="height: auto !important;">
                        <div class="widget-head">
                          <div class="widget-label">
                            <div class="widget-title">
                              <div class="number-label"  style="font-size: 20px;font-weight: bold;font-family: inherit;">Top 10 infected hosts (uuid, comment, hostname)</div>
                            </div>
                            <div class="widget-subtitle"></div>
                          </div>
                          <div class="widget-control">
                            <div class="card-actions dropdown pull-right">
                              <a data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                ...
                              </a>
                              <ul class="dropdown-menu" style="max-height: 300px; overflow-y: auto;">
                                <li class="dropdown-item">
                                  <a data-action="action-refresh">Refresh</a>
                                </li>
                                <li class="dropdown-item">
                                  <a data-action="action-edit">Edit</a>
                                </li>
                              </ul>
                            </div>
                          </div>
                        </div>
                        <div class="widget-body">
                          {% for a in top_hosts %}
                          <div class="widget-content" style="padding-top: 2px !important;">
                            
                            <div class="number" style=" font-size:12px !important; color:rgb(42, 42, 205)"> {{a.name}}, {{a.comments}}, {{a.host_name}}- <strong style="color:#e1a90d; font-weight:bold; font-size:16px;">  {{a.threat}}</strong></div><br>
                            
                          </div>
                          {% endfor %}
                        </div>
                        <div class="widget-footer">
                        </div>
                      </div>

                     </div>
                    
                     <div class="charts" style="max-height: 400px;">
                      <canvas id="chart" width="400" height="400"></canvas>
                     </div>
                    
                      <script src="/assets/defender_antivirus_cloud_manager/www/js/charts.js"></script>


                  </div>
    
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    
    
      <div id="Clients" class="tabcontent">
        <div class="clients_bar" style="display: flex;
            justify-content: space-between;">
          <div class="left">
    
            <input class="form-control" id="exampleDataList" placeholder="Type to search..." style=" display:none;    background: white;
                            width: 400%;
                            margin-top: 5px;
                            margin-bottom: 5px;">
          </div>
    
          {% if us[0][1] == "System User" %}
          <div class="right" style="display:flex;     display: flex; justify-content: flex-end;">
    
            
            <button type="button" id="add_to_client" class="btn btn-primary" data-toggle="modal" data-target="#exampleModal"
              style=" background: #0e85af;     margin-right: 10px;">Add
              client</button>
            <button type="button" class="btn btn-outline-info" data-toggle="modal" data-target="#import_modal" style="color:black;margin-right: 10px;">Import</button>
            
            <button type="button" data-toggle="modal"
            data-target="#deletelist" class="btn btn-danger" style="margin-right: 10px;">Delete all</button>
            <button type="button" class="btn btn-outline-info" onclick="refresh()"><i class="fa fa-refresh" aria-hidden="true"
                style="margin-right:4px;"></i>Refresh</button>
          </div>
          {% else %}
          <div class="right" style="display:flex;     display: flex; justify-content: flex-end;">
    
            
            <button type="button" id="add_to_client" class="btn btn-primary" data-toggle="modal" data-target="#exampleModal"
              style=" background: #0e85af;     margin-right: 10px;" disabled>Add
              client</button>
            <button type="button" class="btn btn-outline-info" data-toggle="modal" data-target="#import_modal" style="color:black; margin-right: 10px;"disabled>Import</button>
            <button type="button" class="btn btn-danger" data-toggle="modal"
            data-target="#deletelist" style="    margin-right: 10px;"disabled>Delete all</button>
            <button type="button" class="btn btn-outline-info "disabled onclick="refresh()"><i class="fa fa-refresh" aria-hidden="true"
                style="margin-right:4px;"></i>Refresh</button>
          </div>

         

          {% endif %}
         
    
        </div>
        <h3></h3>
        <h3>Total Clients </h3>
        {% for a in r %}
    
        <p>AC Record
          {{a.message}}
        </p>
    
        {% endfor %}
    
    
        {% set clients = frappe.db.sql(""" select client_uuid,comments,host_name,name from `tabClients Details` """) %}
        <table id="example" class="display" style="width: 100%">
          <thead>
            <tr style="display:none;">
              <th>Name</th>
              <th>Position</th>
              <th>Office</th>
            </tr>
          </thead>
    
          <tbody>
    
    
    
            {% for c in clients %}
            <tr>
              <td>UUID {{c[0]}}
              </td>
              <td> {{c[1]}} 
              </td>
              <td>{{c[2]}}

                <button id="bt" type="button" onclick="getUserDetails(`{{c[0]}}`);getthreat(`{{c[0]}}`)" data-toggle="modal"
                  data-target="#hostModal" ><i class="fa fa-refresh" aria-hidden="true"></i></button>
                  <button id="updatebt" style="margin-left: 2px; margin-right:2px;" onclick="updateRecord(`{{c[0]}}`, `{{c[1]}}`, `{{c[2]}}`, `{{c[3]}}`)"
                  data-toggle="modal" data-target="#updateexampleModal" {% if us[0][1] == 'System User' %} {% else %} disabled {% endif %}><i class="fa fa-pencil" aria-hidden="true"></i>
                </button>
                <button id="deletebt" onclick="delRecord(`{{c[3]}}`)" data-toggle="modal"
                  data-target="#deleteexampleModal" {% if us[0][1] == 'System User' %} {% else %} disabled {% endif %}><i class="fa fa-trash" aria-hidden="true"></i></button>
              </td>
            </tr>
            {% endfor %}
    
          </tbody>
          <tfoot style="display:none;">
            <tr>
              <th>Name</th>
              <th>Position</th>
              <th>Office</th>
            </tr>
          </tfoot>
        </table>
    
    
    
    
        <!--HOST Details Large Modal-->
    
    
        <div class="modal fade bd-example-modal-lg" id="hostModal" onShow="initialize()" tabindex="-1" role="dialog"
          aria-labelledby="myLargeModalLabel" aria-hidden="true">
          <div class="modal-dialog modal-lg" style="max-width: 1100px !important ">
            <div class="modal-content">
              <div class="host" style="padding: 3%;">
    
                <input type="text" class="host_input" style="width: 15%;color:#57beff" value="Host detail" readonly>
                <input type="text" class="host_input" id="client_uuid" style="width: 36%;" value="" readonly>
                <input type="text" class="host_input" id="client_host_name" style="width: 13%;" value="" readonly>
                <input type="text" class="host_input" style="width: 10%;" value="" id="interval_time">
                <button id="edit_host" {% if us[0][1] == 'System User' %} {% else %} disabled {% endif %} style="z-index: 2;margin-left: -2.8%; border:none; background:none;">
                  <i class="fa fa-pencil" aria-hidden="true"></i></button>
                <button {% if us[0][1] == 'System User' %} {% else %} disabled {% endif %}
                  style=" background:rgb(23, 98, 130);;border-color: #0985ff8c;border-radius: 6px;color: #f7f7f7; cursor:pointer"
                  id="perform_full_scan">Perform Full Scan</button>
                <button
                  style="width: 8%; width: 8%; background: no-repeat;border-color: #0985ff8c;border-radius: 6px;color: #0898d3; cursor:pointer" data-dismiss="modal">Back</button>
    
    
    
                <div class="host_details">
                  <div class="new_version" style="padding-left: 1%;padding-top: 1%;">
                    <input type="checkbox" id="new_version_avail"><label for="new_version_avail" style="margin-left: .5%;    color: #585555d9;
                              font-size: 14px;
                              font-family: revert;">New client software release</label><br>
                    <label for="" style="color: #585555d9; font-size: 14px;font-family: revert;">New client software
                      URL:</label><input id="download-path" type="text" value="" style="margin-left: 0.5%;width: 80%;border: 1px solid #80808042;
                              border-radius: 5px; padding-left:7px;">
                    <button class="btn btn-primary" id="add_version" {% if us[0][1] == 'System User' %} {% else %} disabled {% endif %} style="background:rgb(23, 98, 130);">Save Version
                      Detail</button>
                  </div>
                  <div class="inner_host_details">
                    <h1 style="font-size: 16px;font-weight: bold; padding-top: 10px;">Defender Anti-Virus</h1>
    
                    <div class="row_box_one" style="display: flex; flex-wrap: wrap;">
                      <div class="div1">
                        <p class="div_p">Anti-malware: <b style="color:rgb(21, 192, 21)"><span id="anti_malware"></span></b>
                        </p>
                        <div class="child-divp">
                          <span id="child_div">AM Engine: <small id="am_engine" style="font-weight: bold;"></small></span>
                          <span id="child_div" style="margin-left: 4%; ">AM Product: <small id="am_product"
                              style="font-weight: bold;"></small></span>
                        </div>
    
                      </div>
                      <div class="div1">
                        <p class="div_p">Anti-spyware: <b style="color:rgb(21, 192, 21)"><span id="anti_spyware"></span></b>
                        </p>
                        <div class="child-divp">
                          <span id="child_div">Signature: <small id="signature" style="font-weight: bold;"></small></span>
                        </div>
    
                      </div>
                      <div class="div1">
                        <p class="div_p">Anti-virus: <b style="color:rgb(21, 192, 21)"><span id="anti_virus"></span></b></p>
    
                      </div>
                    </div>
    
                    <div class="row_box_one" style="display: flex; flex-wrap: wrap;">
                      <div class="div1">
                        <p class="div_p">Behaviour Monitor: <b style="color:rgb(21, 192, 21)"><span
                              id="behaviour_monitor"></span></b></p>
                      </div>
                      <div class="div1">
                        <p class="div_p">Tamper Protection: <b style="color:rgb(218, 14, 14)"><span
                              id="tamper_protection"></span></b></p>
                      </div>
                      <div class="div1">
                        <p class="div_p">Office Antivirus: <b style="color:rgb(21, 192, 21)"><span
                              id="office_antivirus"></span></b></p>
                      </div>
                    </div>
    
                    <div class="row_box_one" style="display: flex; flex-wrap: wrap;">
                      <div class="div1">
                        <p class="div_p">Network Inspection System: <b style="color:rgb(21, 192, 21)"><span
                              id="network_inspection_system"></span></b></p>
                        <div class="child-divp">
                          <span id="child_div">NIS Engine: <small id="nis_engine" style="font-weight: bold;"></small></span>
                          <span id="child_div" style="margin-left: 4%; ">Signature: <small id="signature1"
                              style="font-weight: bold;"></small></span>
                        </div>
                      </div>
                      <div class="div1">
                        <p class="div_p">On-Access Protection: <b><span id="on_access_protection"></span></b></p>
                      </div>
                      <div class="div1">
                        <p class="div_p">Real-time Protection: <b> <span id="real_time_protection"></span></b></p>
                      </div>
                    </div>
    
    
                    <div class="row_box_one" style="display: flex; flex-wrap: wrap;">
                      <div class="div2">
                        <p class="div_d" style="padding: 4%;">Threat Found: <b style="color:rgb(214, 12, 12)"><span
                              id="total_threats"></span></b></p>
                      </div>
                      <button class="div1" data-toggle="modal" data-target="#threatlist"
                        style="background-color: rgb(23, 98, 130); padding:3%; color:white; display:pointer;"
                        id="list_of_threat" onclick="getclientsthreats()"> See list of found threats</button>
                    </div>
    
                    <h1 style="font-size: 16px;font-weight: bold; padding-top: 10px;">Firewall Protection</h1>
    
                    <div class="row_box_one" style="display: flex; flex-wrap: wrap;">
                      <div class="div1">
                        <p class="div_p">Domain: <b><span id="domain"></span></b></p>
    
                      </div>
                      <div class="div1">
                        <p class="div_p">Public: <b><span id="public"></span></b></p>
                      </div>
                      <div class="div1">
                        <p class="div_p">Private: <b><span id="private"></span> </b></p>
    
                      </div>
                    </div>
    
    
                    <h1 style="font-size: 16px;font-weight: bold; padding-top: 10px;">Update</h1>
    
                    <div class="row_box_one" style="display: flex; flex-wrap: wrap;">
                      <div class="div1">
                        <p class="div_p">Agent version: <b style="color:rgb(21, 192, 21)"><span
                              id="agent_version"></span></b></p>
                      </div>
                      <div class="div1">
                        <p class="div_p">Signature update: <b style="color:rgb(192, 61, 21)"><span
                              id="signature_update"></span></b></p>
    
                      </div>
                      <div class="div1">
                        <p class="div_p">Last update: <b style="color:rgb(29, 39, 29)"><span id="last_update"></span></b>
                        </p>
    
                      </div>
                    </div>
    
    
    
                    <h1 style="font-size: 16px;font-weight: bold; padding-top: 10px;">System</h1>
    
                    <div class="row_box_one" style="display: flex; flex-wrap: wrap;">
                      <div class="div1">
                        <p class="div_p">OS: <span id="os" style="font-weight: bold;"></span> <b
                            style="color:rgb(29, 39, 29)"></b></p>
    
                      </div>
                      <div class="div1">
                        <p class="div_p">OS version: <span id="os_version" style="font-weight: bold;"></span> <b
                            style="color:rgb(29, 39, 29)"></b></p>
    
                      </div>
                      <div class="div1">
                        <p class="div_p">Manufacturer:<span id="manufacturer" style="font-weight: bold;"></span> <b
                            style="color:rgb(29, 39, 29)"></b></p>
    
                      </div>
    
    
                      <div class="div1">
                        <p class="div_p">Model: <span id="model" style="font-weight: bold;"></span> <b
                            style="color:rgb(29, 39, 29)"></b></p>
    
                      </div>
                      <div class="div1" style="padding: 2% !important;">
                        <p class="div_s" style="margin: 0px !important;">Full Scan Start: <span id="full_scan_start"
                            style="font-weight: bold;"></span></p>
                        <p class="div_s" style="margin: 0px !important;">Full Scan End: <span id="full_scan_end"
                            style="font-weight: bold;"></span></p>
                      </div>
                      <div class="div1" style="padding: 2% !important;">
                        <p class="div_s" style="margin: 0px !important;">Last Full Scan Source: <span
                            id="last_full_scan_source" style="font-weight: bold;"></span></p>
                        <p class="div_s" style="margin: 0px !important;">Last Quick Scan Source: <span
                            id="last_quick_scan_source" style="font-weight: bold;"></span></p>
    
                      </div>
                    </div>
    
                  </div>
    
                </div>
    
              </div>
            </div>
          </div>
        </div>
    
        <!--Host Detals END-->
    
    
        <!-- Modal -->
    
        <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
          aria-hidden="true">
          <div class="modal-dialog" role="document">
            <div class="modal-content" style="    border-radius: 21px !important;">
              <div class="modal-header" style="border-bottom: none !important; padding-top: 0px !important;">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"
                  style="margin-top: -4px !important;">
                  <span aria-hidden="true">&times;</span>
                </button>
    
              </div>
              <div class="modal-body">
                <form>
                  <div class="form-group">
                    <label for="recipient-name" class="col-form-label">UUID:</label>
                    <input type="text" class="form-control" id="uuid">
                    <span id="uuid_error"></span>
                  </div>
                  <div class="form-group">
                    <label for="comment" class="col-form-label">Comment:</label>
                    <input type="text" class="form-control" id="comment">
                    <span id="comment_error"></span>
                  </div>
    
                  <div class="form-group" style="display: none;">
                    <label for="hostname" class="col-form-label">Hostname:</label>
                    <input type="text" class="form-control" id="hostname" readonly>
                  </div>
                  <div id="cleint_added"></div>
                </form>
              </div>
              <div class="modal-footer">
                <button type="button" style="color: #fff;background-color: #b23cfd;" class="btn btn-secondary"
                  data-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" id="add-user">Add</button>
                
               
              </div>
            </div>
          </div>
        </div>
    
    
        <!-- Your JS code here  -->
    
        <!--Update UUID and Comments-->
    
        <div class="modal fade" id="updateexampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
          aria-hidden="true">
          <div class="modal-dialog" role="document">
            <div class="modal-content" style="    border-radius: 21px !important;">
              <div class="modal-header" style="border-bottom: none !important; padding-top: 0px !important;">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"
                  style="margin-top: -4px !important;">
                  <span aria-hidden="true">&times;</span>
                </button>
    
              </div>
    
              <div class="updateform">
                <input type="text" class="ac" id="updateuuid1" readonly>
                <input type="text" class="ac" id="updatecomment1">
                <input type="text" class="ac" id="updatehostname1" readonly>
    
                <input type="text" class="ac" id="updatename1" readonly>

                <div id="cleint_update"></div>
    
              </div>
    
              <div class="modal-footer">
                <button type="button" style="color: #fff;background-color: #b23cfd;" class="btn btn-secondary"
                  data-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" id="update-user">Update</button>
              </div>
            </div>
          </div>
        </div>
    
        <style>
          .updateform {
            padding: 3%;
          }
    
          .ac {
            width: 100%;
            border-color: #d4d3d16b;
            height: 38px;
            border-radius: 6px;
            margin-bottom: 16px;
          }
        </style>

        <!--Import-->
        <div class="modal fade" id="import_modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-lg" role="document" style="max-width: 900px !important;">
          <div class="modal-content" style="border-radius: 21px !important;">
            <div class="modal-header" style="border-bottom: none !important; padding-top: 0px !important;">
              <button type="button" class="close" data-dismiss="modal" aria-label="Close"
                style="margin-top: -4px !important;">
                <span aria-hidden="true">&times;</span>
              </button>
  
            </div>
            <h5 style="color: #083fd5; margin-left:5% !important;">Import Excel File</h5>
            <div class="import_list" style="    margin-left: 5%;">
              <input type="file" id="input">
              <table id="tbl-data" style="    margin-top: 2%;"></table>
            </div>
            
  
           
            <div id="cleint_deleted" style="margin-left: 5%;"></div>
  
            <div class="modal-footer">
              <button type="button" style="color: #fff;background-color: #b23cfd;" class="btn btn-secondary"
                data-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" id="save_import">Save</button>
            </div>
          </div>
        </div>
      </div>

        <!--Show List of Threats-->
        
        <!--End Lst of Threats-->
    
        <div class="modal fade" id="threatlist" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-lg" role="document" style="max-width: 900px !important;">
          <div class="modal-content" style="border-radius: 21px !important;">
            <div class="modal-header" style="border-bottom: none !important; padding-top: 0px !important;">
              <button type="button" class="close" data-dismiss="modal" aria-label="Close"
                style="margin-top: -4px !important;">
                <span aria-hidden="true">&times;</span>
              </button>
  
            </div>
            <h5 style="color: #083fd5; margin-left:5% !important;">Threat</h5>
            <div class="outer" id="outer_div">
             
            </div>
            
  
           
            <div id="cleint_deleted" style="margin-left: 5%;"></div>
  
            <div class="modal-footer">
              <button type="button" style="color: #fff;background-color: #b23cfd;" class="btn btn-secondary"
                data-dismiss="modal">Close</button>
            </div>
          </div>
        </div>
      </div>
  
        <!--End Update uuid and comments-->
    



        <div class="modal fade" id="deletelist" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
          aria-hidden="true">
          <div class="modal-dialog" role="document">
            <div class="modal-content" style="border-radius: 21px !important;">
              <div class="modal-header" style="border-bottom: none !important; padding-top: 0px !important;">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"
                  style="margin-top: -4px !important;">
                  <span aria-hidden="true">&times;</span>
                </button>
    
              </div>
              <h5 style="color: #083fd5; margin-left:5% !important;">Delete Record</h5>
    
              <p style="margin-left:5% !important;">Are you sure you want to delete all clients!!</p>
              <div class="form-group" style="display: none;">
                <label for="userid" class="col-form-label">UUID:</label>
                <input type="text" class="form-control" id="userid" readonly>
                
              </div>
              <div id="cleint_deleted" style="margin-left: 5%;"></div>
    
              <div class="modal-footer">
                <button type="button" style="color: #fff;background-color: #b23cfd;" class="btn btn-secondary"
                  data-dismiss="modal">Close</button>
                <button type="button"  id="delete-all-record" class="btn btn-danger" id="delete-user">Confirm</button>
              </div>
            </div>
          </div>
        </div>




        <!--Delete UUID and Comments-->
    
        <div class="modal fade" id="deleteexampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
          aria-hidden="true">
          <div class="modal-dialog" role="document">
            <div class="modal-content" style="border-radius: 21px !important;">
              <div class="modal-header" style="border-bottom: none !important; padding-top: 0px !important;">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"
                  style="margin-top: -4px !important;">
                  <span aria-hidden="true">&times;</span>
                </button>
    
              </div>
              <h5 style="color: #083fd5; margin-left:5% !important;">Delete Record</h5>
    
              <p style="margin-left:5% !important;">Are you sure you want to delete!!</p>
              <div class="form-group" style="display: none;">
                <label for="userid" class="col-form-label">UUID:</label>
                <input type="text" class="form-control" id="userid" readonly>
                
              </div>
              <div id="cleint_deleted" style="margin-left: 5%;"></div>
    
              <div class="modal-footer">
                <button type="button" style="color: #fff;background-color: #b23cfd;" class="btn btn-secondary"
                  data-dismiss="modal">Close</button>
                <button type="button" id="delete-one-record" class="btn btn-danger" id="delete-user">Confirm</button>
              </div>
            </div>
          </div>
        </div>
    
        <!--End Delte uuid and comments-->
    
      </div>
    
     
    
      <div id="Logs" class="tabcontent">
        <h3>Logs</h3>
        {% set clients = frappe.db.sql(""" select uuid,host_name,date,registered_uuid from `tabDefender Logs` """) %}
        <table id="example1" class="display" style="width: 100%">
          <thead>
            <tr >
              <th>UUID</th>
              <th>Host Name</th>
              <th>Date</th>
              <th>Status</th>
            </tr>
          </thead>
    
          <tbody>
    
    
    
            {% for c in clients %}
            <tr>
              <td>UUID {{c[0]}}</td>
              <td> {{c[1]}} </td>
              <td>{{c[2]}}</td>
              <td>{% if c[3] == 1 %} <strong style="color: rgb(8, 209, 8);">Registered</strong>  {% else %} <strong style="color: rgb(192, 7, 7);">Not Registered</strong> {% endif %}</td>
            </tr>
            {% endfor %}
    
          </tbody>
          <tfoot style="display:none;">
            <tr>
              <th>Name</th>
              <th>Position</th>
              <th>Office</th>
            </tr>
          </tfoot>
        </table>
      </div>
    </div>
    {% endwith %}



    <script>


        function show() {
            alert("Data Exported")
        }
        function openCity(evt, cityName) {
            var i, tabcontent, tablinks;
            tabcontent = document.getElementsByClassName("tabcontent");
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = "none";
            }
            tablinks = document.getElementsByClassName("tablinks");
            for (i = 0; i < tablinks.length; i++) {
                tablinks[i].className = tablinks[i].className.replace(" active", "");
            }
            document.getElementById(cityName).style.display = "block";
            evt.currentTarget.className += " active";
            $('#example').DataTable();
            $(document).ready(function () {
                $('#example').DataTable();
                console.log("I am Calll")
            });

            $('#example1').DataTable();
            $(document).ready(function () {
                $('#example1').DataTable();
                console.log("I am Calll")
            });

           




        }
        function refresh() {
          location.reload();
        }
     
          function goto() {
            window.location.href = "/login";
          }


        // Get the element with id="defaultOpen" and click on it
        document.getElementById("defaultOpen").click();

       
        $('#exampleModal').on('show.bs.modal', function (event) {
            var button = $(event.relatedTarget) // Button that triggered the modal
            var recipient = button.data('whatever')
            var modal = $(this)
            modal.find('.modal-title').text('New message to ' + recipient)
            modal.find('.modal-body input').val(recipient)
          })

          $('#updateexampleModal').on('show.bs.modal', function (event) {
            var button = $(event.relatedTarget) // Button that triggered the modal
            var recipient = button.data('whatever')
            var modal = $(this)
            modal.find('.modal-title').text('New message to ' + recipient)
            modal.find('.modal-body input').val(recipient)
          })
          

         

          $('#deleteexampleModal').on('show.bs.modal', function (event) {
            var button = $(event.relatedTarget) // Button that triggered the modal
            var recipient = button.data('whatever')
            var modal = $(this)
            modal.find('.modal-title').text('New message to ' + recipient)
            modal.find('.modal-body input').val(recipient)
          })

          $('#hostModal').on('show.bs.modal', function (event) {
            var button = $(event.relatedTarget) // Button that triggered the modal
            var recipient = button.data('whatever')
            var modal = $(this)
            modal.find('.modal-title').text('New message to ' + recipient)
            modal.find('.modal-body input').val(recipient)
          })
          $('#threatlist').on('show.bs.modal', function (event) {
            var button = $(event.relatedTarget) // Button that triggered the modal
            var recipient = button.data('whatever')
            var modal = $(this)
            modal.find('.modal-title').text('New message to ' + recipient)
            modal.find('.modal-body input').val(recipient)
          })

          $('#deletelist').on('show.bs.modal', function (event) {
            var button = $(event.relatedTarget) // Button that triggered the modal
            var recipient = button.data('whatever')
            var modal = $(this)
            modal.find('.modal-title').text('New message to ' + recipient)
            modal.find('.modal-body input').val(recipient)
          })

          function addUser() {
              alert("Data Saved Successfully!!")
          }
          var input = document.getElementById("input");
          const tbl_data = document.querySelector("#tbl-data");

          const brands = [];
          input.addEventListener('change', function() {
            readXlsxFile(input.files[0]).then(function(data) {
              data.forEach((f, index) => {
                var count = brands.push({"uuid":f[0], "host":f[1]});
                tbl_data.innerHTML +=` 
                <li style="list-style: none;margin-bottom: 10px;"> <span id="uuid_item" style="border: 1px solid gray;border-radius: 4px;padding: 4px;"> ${f[0]}</span>  
                  <span id="host_item" style="border: 1px solid gray;border-radius: 4px;padding: 4px;"> ${f[1]} <span></li>
              
              `
            })
            
            })
      
          })

          document.querySelector("#save_import").addEventListener('click',
          (e) => {
              brands.forEach((b) => {
                fetch('/api/method/defender_antivirus_cloud_manager.utils.insertExcel', {
                  method: 'POST',
                  headers : {
                      'Content-Type' : 'application/json',
                      'X-Frappe-CSRF-Token': frappe.csrf_token
                  },
                  body: JSON.stringify({
                    uuid:b['uuid'],
                    host:b['host']
                  })
      
              }).then(r => r.json())
              .then(r => {
                  console.log("OBJ",r.message)
              })
      
              })
             
      
          })


    </script>

    <script src="/assets/defender_antivirus_cloud_manager/www/bootstrap-4.2.1/js/bootstrap.bundle.min.js"></script>

    <hr>


    <script type="text/javascript" src="/assets/js/libs.min.js?ver=1634032939.0"></script>
    <script type="text/javascript" src="/assets/js/desk.min.js?ver=1634032939.0"></script>
    <script type="text/javascript" src="/assets/js/list.min.js?ver=1634032939.0"></script>
    <script type="text/javascript" src="/assets/js/form.min.js?ver=1634032939.0"></script>
    <script type="text/javascript" src="/assets/js/control.min.js?ver=1634032939.0"></script>
    <script type="text/javascript" src="/assets/js/report.min.js?ver=1634032939.0"></script>
    <script type="text/javascript" src="/assets/js/erpnext.min.js?ver=1634032939.0"></script>
   



    <script>
        frappe.csrf_token = "{{frappe.session.csrf_token}}";
    </script>

        {% block script %}
        <script src="/assets/defender_antivirus_cloud_manager/www/js/test/index.js"></script>
        {% endblock %}


</body>

</html>